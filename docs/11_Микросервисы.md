# **11. –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, Spring Cloud, Docker & Kubernetes**

## **1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤**  

### **REST vs gRPC**  
| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞       | REST (HTTP/JSON)                          | gRPC (HTTP/2 + Protobuf)               |
|----------------------|------------------------------------------|----------------------------------------|
| **–°–∫–æ—Ä–æ—Å—Ç—å**         | –ú–µ–¥–ª–µ–Ω–Ω–µ–µ (—Ç–µ–∫—Å—Ç–æ–≤—ã–π JSON)              | –ë—ã—Å—Ç—Ä–µ–µ (–±–∏–Ω–∞—Ä–Ω—ã–π Protobuf)            |
| **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —è–∑—ã–∫–æ–≤** | –õ—é–±—ã–µ (HTTP-–∫–ª–∏–µ–Ω—Ç—ã)                     | –ú–Ω–æ–∂–µ—Å—Ç–≤–æ (–Ω–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∫–æ–¥–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è) |
| **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**    | –í–µ–±-API, –≤–Ω–µ—à–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏              | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã, high-load —Å–∏—Å—Ç–µ–º—ã  |

**–ü—Ä–∏–º–µ—Ä REST (Spring Boot):**
```java
@RestController
public class UserController {
    @GetMapping("/users/{id}")
    public User getUser(@PathVariable Long id) { ... }
}
```

**–ü—Ä–∏–º–µ—Ä gRPC (Protobuf + Java):**
```protobuf
service UserService {
    rpc GetUser (UserRequest) returns (UserResponse);
}
message UserRequest { int64 id = 1; }
```

---

### **API Gateway**  
–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤: –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ.  

**–§—É–Ω–∫—Ü–∏–∏:**  
- **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è** (`/orders` ‚Üí Order Service).  
- **–ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤).  
- **Rate Limiting** (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤).  

**–ü—Ä–∏–º–µ—Ä—ã:**  
- **Spring Cloud Gateway** (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–º–µ–Ω–∞ Zuul).  
- **Kong** / **Apigee** (–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è).  

---

### **Service Discovery**  
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —Å—Ä–µ–¥–µ (Docker/K8s).  

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç?**  
1. –°–µ—Ä–≤–∏—Å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ **Eureka** (–∏–ª–∏ Consul/Zookeeper).  
2. –î—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç –∞–¥—Ä–µ—Å —á–µ—Ä–µ–∑ Discovery Client.  

**–ü—Ä–∏–º–µ—Ä (Spring Cloud Eureka):**  
```yaml
# application.yml
eureka:
  client:
    serviceUrl:
      defaultZone: http://eureka-server:8761/eureka/
```

---

## **2. Spring Cloud**  
–ù–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤.  

### **Eureka (Service Discovery)**  
- –°–µ—Ä–≤–µ—Ä (`@EnableEurekaServer`) –∏ –∫–ª–∏–µ–Ω—Ç—ã (`@EnableDiscoveryClient`).  
- –°–µ—Ä–≤–∏—Å—ã —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç heartbeat.  

### **Zuul / Spring Cloud Gateway (API Gateway)**  
- **Zuul** (—É—Å—Ç–∞—Ä–µ–≤—à–∏–π, –Ω–æ –ø—Ä–æ—Å—Ç–æ–π):  
  ```java
  @EnableZuulProxy
  public class GatewayApplication { ... }
  ```  
- **Spring Cloud Gateway** (–∞–∫—Ç—É–∞–ª—å–Ω—ã–π, –Ω–∞ WebFlux):  
  ```yaml
  spring:
    cloud:
      gateway:
        routes:
          - id: order-service
            uri: lb://order-service
            predicates:
              - Path=/orders/**
  ```  

### **Feign (REST-–∫–ª–∏–µ–Ω—Ç)**  
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTTP-–∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.  

**–ü—Ä–∏–º–µ—Ä:**  
```java
@FeignClient(name = "user-service")
public interface UserClient {
    @GetMapping("/users/{id}")
    User getUser(@PathVariable Long id);
}
```

### **Hystrix (Circuit Breaker)**  
–ó–∞—â–∏—Ç–∞ –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö –æ—à–∏–±–æ–∫:  
- **Fallback** ‚Äì –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –æ—Ç–≤–µ—Ç –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞.  
- **Circuit Breaker** ‚Äì –≤—Ä–µ–º–µ–Ω–Ω—ã–π –æ—Ç–∫–∞–∑ –æ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö –æ—à–∏–±–∫–∞—Ö.  

**–ü—Ä–∏–º–µ—Ä:**  
```java
@HystrixCommand(fallbackMethod = "getDefaultUser")
public User getUser(Long id) { ... }

public User getDefaultUser(Long id) {
    return new User("default", 0);
}
```

> **–í–∞–∂–Ω–æ:** Hystrix deprecated, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Resilience4j** –∏–ª–∏ **Spring Cloud Circuit Breaker**.

---

## **3. Docker + Kubernetes**  

### **Docker (–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è)**  
–£–ø–∞–∫–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å–æ –≤—Å–µ–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏.  

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**  
```bash
docker build -t my-service .       # –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑
docker run -p 8080:8080 my-service # –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker push my-repo/my-service     # –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ —Ä–µ–µ—Å—Ç—Ä (Docker Hub)
```

**Dockerfile:**  
```dockerfile
FROM openjdk:17
COPY target/my-service.jar app.jar
ENTRYPOINT ["java", "-jar", "app.jar"]
```

---

### **Kubernetes (–û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è)**  
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤: –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ, –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞, self-healing.  

**–û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏:**  
- **Pod** ‚Äì –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –µ–¥–∏–Ω–∏—Ü–∞ (1+ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä).  
- **Deployment** ‚Äì –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.  
- **Service** ‚Äì –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π IP –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Pod‚Äô–∞–º.  

**–ü—Ä–∏–º–µ—Ä Deployment (order-service.yml):**  
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: order-service
spec:
  replicas: 3
  selector:
    matchLabels:
      app: order-service
  template:
    metadata:
      labels:
        app: order-service
    spec:
      containers:
        - name: order-service
          image: my-repo/order-service:latest
          ports:
            - containerPort: 8080
```

**–ü—Ä–∏–º–µ—Ä Service:**  
```yaml
apiVersion: v1
kind: Service
metadata:
  name: order-service
spec:
  selector:
    app: order-service
  ports:
    - protocol: TCP
      port: 80
      targetPort: 8080
  type: LoadBalancer
```

---

## **–ö–æ–≥–¥–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?**  
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç              | –†–µ—à–∞–µ–º–∞—è –ø—Ä–æ–±–ª–µ–º–∞                                      | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã                     |
|------------------------|-------------------------------------------------------|----------------------------------|
| **API Gateway**        | –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è                    | Kong, Apigee                    |
| **Service Discovery**  | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤                     | Consul, Zookeeper               |
| **Docker**            | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ—Å—Ç–∏                     | Podman                          |
| **Kubernetes**        | –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ                              | Docker Swarm, Nomad             |

---

### **–ò—Ç–æ–≥**  
1. **REST/gRPC** ‚Äì –≤—ã–±–æ—Ä –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.  
2. **Spring Cloud** ‚Äì —É–ø—Ä–æ—â–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ (Eureka, Feign, Hystrix).  
3. **Docker+K8s** ‚Äì —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è.  

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã —Ç—Ä–µ–±—É—é—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö –∑–∞—Ç—Ä–∞—Ç, –Ω–æ –¥–∞—é—Ç –≥–∏–±–∫–æ—Å—Ç—å –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å! üöÄ
