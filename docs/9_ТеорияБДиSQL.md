# **9. –¢–µ–æ—Ä–∏—è –ë–î –∏ SQL: –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ —Ñ–æ—Ä–º—ã, JOIN, –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**  

## **1. –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ —Ñ–æ—Ä–º—ã (1NF, 2NF, 3NF)**  
–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ë–î ‚Äî –ø—Ä–æ—Ü–µ—Å—Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ —É–ª—É—á—à–µ–Ω–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏.  

### **1NF (–ü–µ—Ä–≤–∞—è –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞)**  
- –ö–∞–∂–¥–∞—è —è—á–µ–π–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç **–∞—Ç–æ–º–∞—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ** (–Ω–µ —Å–ø–∏—Å–∫–∏, –Ω–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞).  
- –ù–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Å—Ç—Ä–æ–∫.  
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω **–ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á**.  

‚ùå **–ü–ª–æ—Ö–æ** (–Ω–∞—Ä—É—à–µ–Ω–∏–µ 1NF):  
| student_id | courses         |  
|------------|----------------|  
| 1          | Math, Physics  |  

‚úÖ **–•–æ—Ä–æ—à–æ** (1NF):  
| student_id | course   |  
|------------|----------|  
| 1          | Math     |  
| 1          | Physics  |  

---

### **2NF (–í—Ç–æ—Ä–∞—è –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞)**  
- –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å **1NF**.  
- –í—Å–µ –Ω–µ–∫–ª—é—á–µ–≤—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–∏—Å—è—Ç –æ—Ç –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞** (–Ω–µ—Ç —á–∞—Å—Ç–∏—á–Ω–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏).  

‚ùå **–ü–ª–æ—Ö–æ** (—á–∞—Å—Ç–∏—á–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å):  
| **order_id** (PK) | product_id | product_name | quantity |  
|-------------------|------------|--------------|----------|  
| 1                 | 101        | Laptop       | 2        |  

‚úÖ **–•–æ—Ä–æ—à–æ** (2NF):  
**–¢–∞–±–ª–∏—Ü–∞ `orders`:**  
| **order_id** (PK) | product_id | quantity |  
|-------------------|------------|----------|  

**–¢–∞–±–ª–∏—Ü–∞ `products`:**  
| **product_id** (PK) | product_name |  
|---------------------|--------------|  

---

### **3NF (–¢—Ä–µ—Ç—å—è –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞)**  
- –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å **2NF**.  
- –ù–µ—Ç **—Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** (–Ω–µ–∫–ª—é—á–µ–≤—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –¥—Ä—É–≥–∏—Ö –Ω–µ–∫–ª—é—á–µ–≤—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤).  

‚ùå **–ü–ª–æ—Ö–æ** (—Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å):  
| **employee_id** (PK) | department | manager      |  
|----------------------|------------|--------------|  
| 1                    | IT         | John Doe     |  

‚úÖ **–•–æ—Ä–æ—à–æ** (3NF):  
**–¢–∞–±–ª–∏—Ü–∞ `employees`:**  
| **employee_id** (PK) | department_id |  
|----------------------|---------------|  

**–¢–∞–±–ª–∏—Ü–∞ `departments`:**  
| **department_id** (PK) | department | manager      |  
|------------------------|------------|--------------|  

---

## **2. –¢–∏–ø—ã JOIN**  
–û–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü.  

### **INNER JOIN**  
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç **—Ç–æ–ª—å–∫–æ —Å–æ–≤–ø–∞–¥–∞—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏** –∏–∑ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü.  
```sql
SELECT u.name, o.order_id 
FROM users u 
INNER JOIN orders o ON u.id = o.user_id;
```  
(–ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤, –æ–Ω –Ω–µ –ø–æ–ø–∞–¥–µ—Ç –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.)  

### **LEFT JOIN (LEFT OUTER JOIN)**  
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ –ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã** + —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Å–ø—Ä–∞–≤–∞.  
- –ï—Å–ª–∏ —Å–ø—Ä–∞–≤–∞ –Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π ‚Äî `NULL`.  
```sql
SELECT u.name, o.order_id 
FROM users u 
LEFT JOIN orders o ON u.id = o.user_id;
```  
(–ü–æ–∫–∞–∂–µ—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –¥–∞–∂–µ –±–µ–∑ –∑–∞–∫–∞–∑–æ–≤.)  

### **RIGHT JOIN (RIGHT OUTER JOIN)**  
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ `LEFT JOIN`, –Ω–æ **–≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ –ø—Ä–∞–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã**.  
```sql
SELECT u.name, o.order_id 
FROM users u 
RIGHT JOIN orders o ON u.id = o.user_id;
```  
(–ü–æ–∫–∞–∂–µ—Ç –≤—Å–µ –∑–∞–∫–∞–∑—ã, –¥–∞–∂–µ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω.)  

### **FULL JOIN (FULL OUTER JOIN)**  
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ –æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü**, –∑–∞–ø–æ–ª–Ω—è—è `NULL` –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π.  
```sql
SELECT u.name, o.order_id 
FROM users u 
FULL JOIN orders o ON u.id = o.user_id;
```  
(–ü–æ–∫–∞–∂–µ—Ç –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ–∑ –∑–∞–∫–∞–∑–æ–≤, –∏ –∑–∞–∫–∞–∑—ã –±–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.)  

---

## **3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤**  

### **–ò–Ω–¥–µ–∫—Å—ã**  
- –£—Å–∫–æ—Ä—è—é—Ç –ø–æ–∏—Å–∫ (`WHERE`, `JOIN`, `ORDER BY`).  
- –ó–∞–º–µ–¥–ª—è—é—Ç `INSERT`/`UPDATE`/`DELETE` (–∏–Ω–¥–µ–∫—Å –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å—Ç—Ä–∞–∏–≤–∞—Ç—å).  
- –ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è:  
  ```sql
  CREATE INDEX idx_user_email ON users(email);
  ```  

### **EXPLAIN**  
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç **–ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞**, –ø–æ–º–æ–≥–∞—è –Ω–∞–π—Ç–∏ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞.  

```sql
EXPLAIN SELECT * FROM users WHERE age > 25;
```  

#### **–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**  
- **`Seq Scan`** (–ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ–±–æ—Ä —Å—Ç—Ä–æ–∫) ‚Üí –º–µ–¥–ª–µ–Ω–Ω–æ, –Ω—É–∂–µ–Ω –∏–Ω–¥–µ–∫—Å.  
- **`Index Scan`** (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞) ‚Üí —Ö–æ—Ä–æ—à–æ.  
- **`Cost`** ‚Äì –æ—Ü–µ–Ω–∫–∞ –∑–∞—Ç—Ä–∞—Ç–Ω–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏.  

#### **–ö–∞–∫ —É–ª—É—á—à–∏—Ç—å –∑–∞–ø—Ä–æ—Å?**  
1. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è.  
2. –ò–∑–±–µ–≥–∞—Ç—å `SELECT *` ‚Äì –≤—ã–±–∏—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã.  
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `LIMIT` –¥–ª—è –±–æ–ª—å—à–∏—Ö –≤—ã–±–æ—Ä–æ–∫.  
4. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å `JOIN` (–ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ—Ä—è–¥–æ–∫ —Ç–∞–±–ª–∏—Ü).  

---

### **–í—ã–≤–æ–¥**  
- **–ù–æ—Ä–º–∞–ª—å–Ω—ã–µ —Ñ–æ—Ä–º—ã** —É–º–µ–Ω—å—à–∞—é—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞–Ω–æ–º–∞–ª–∏–∏.  
- **JOIN** –ø–æ–∑–≤–æ–ª—è–µ—Ç –≥–∏–±–∫–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ.  
- **–ò–Ω–¥–µ–∫—Å—ã + EXPLAIN** ‚Äì –∫–ª—é—á–µ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.  

–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î –∏ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å–∏–ª—å–Ω–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å! üöÄ
